var cov_i28jkyac9=function(){var path="/Users/skinyori/Documents/workspace/interview/recruit-05-19-ph2/models/inventory.js";var hash="7cb68de34ecf32e4a00a57f7564f64146fb32769";var global=new Function("return this")();var gcv="__coverage__";var coverageData={path:"/Users/skinyori/Documents/workspace/interview/recruit-05-19-ph2/models/inventory.js",statementMap:{"0":{start:{line:1,column:11},end:{line:1,column:33}},"1":{start:{line:2,column:0},end:{line:50,column:2}},"2":{start:{line:3,column:22},end:{line:23,column:10}},"3":{start:{line:24,column:4},end:{line:27,column:6}},"4":{start:{line:25,column:8},end:{line:25,column:37}},"5":{start:{line:26,column:8},end:{line:26,column:43}},"6":{start:{line:28,column:4},end:{line:48,column:7}},"7":{start:{line:29,column:8},end:{line:47,column:10}},"8":{start:{line:35,column:12},end:{line:46,column:18}},"9":{start:{line:37,column:20},end:{line:45,column:21}},"10":{start:{line:38,column:24},end:{line:44,column:47}},"11":{start:{line:44,column:40},end:{line:44,column:45}},"12":{start:{line:49,column:4},end:{line:49,column:21}}},fnMap:{"0":{name:"(anonymous_0)",decl:{start:{line:2,column:17},end:{line:2,column:18}},loc:{start:{line:2,column:43},end:{line:50,column:1}},line:2},"1":{name:"(anonymous_1)",decl:{start:{line:24,column:26},end:{line:24,column:27}},loc:{start:{line:24,column:62},end:{line:27,column:5}},line:24},"2":{name:"(anonymous_2)",decl:{start:{line:28,column:26},end:{line:28,column:27}},loc:{start:{line:28,column:38},end:{line:48,column:5}},line:28},"3":{name:"(anonymous_3)",decl:{start:{line:34,column:16},end:{line:34,column:17}},loc:{start:{line:34,column:27},end:{line:47,column:9}},line:34},"4":{name:"(anonymous_4)",decl:{start:{line:36,column:22},end:{line:36,column:23}},loc:{start:{line:36,column:33},end:{line:46,column:17}},line:36},"5":{name:"(anonymous_5)",decl:{start:{line:44,column:32},end:{line:44,column:33}},loc:{start:{line:44,column:40},end:{line:44,column:45}},line:44}},branchMap:{"0":{loc:{start:{line:37,column:20},end:{line:45,column:21}},type:"if",locations:[{start:{line:37,column:20},end:{line:45,column:21}},{start:{line:37,column:20},end:{line:45,column:21}}],line:37}},s:{"0":0,"1":0,"2":0,"3":0,"4":0,"5":0,"6":0,"7":0,"8":0,"9":0,"10":0,"11":0,"12":0},f:{"0":0,"1":0,"2":0,"3":0,"4":0,"5":0},b:{"0":[0,0]},_coverageSchema:"43e27e138ebf9cfc5966b082cf9a028302ed4184",hash:"7cb68de34ecf32e4a00a57f7564f64146fb32769"};var coverage=global[gcv]||(global[gcv]={});if(coverage[path]&&coverage[path].hash===hash){return coverage[path];}return coverage[path]=coverageData;}();const db=(cov_i28jkyac9.s[0]++,require('./../models'));cov_i28jkyac9.s[1]++;module.exports=(sequelize,DataTypes)=>{cov_i28jkyac9.f[0]++;const inventory=(cov_i28jkyac9.s[2]++,sequelize.define('inventory',{batchNo:{type:DataTypes.INTEGER,allowNull:false},suppliedQuantity:{type:DataTypes.INTEGER,allowNull:false},stockQuantity:{type:DataTypes.INTEGER},createdAt:{allowNull:false,type:DataTypes.DATE,defaultValue:sequelize.fn('NOW')},updatedAt:{allowNull:false,type:DataTypes.DATE,defaultValue:sequelize.fn('NOW')}},{}));cov_i28jkyac9.s[3]++;inventory.associate=function({product,purchaseOrder}){cov_i28jkyac9.f[1]++;cov_i28jkyac9.s[4]++;inventory.belongsTo(product);cov_i28jkyac9.s[5]++;inventory.belongsTo(purchaseOrder);};cov_i28jkyac9.s[6]++;inventory.afterUpdate(invRec=>{cov_i28jkyac9.f[2]++;cov_i28jkyac9.s[7]++;return inventory.findAll({where:{productId:invRec.productId},attributes:['productId',[sequelize.fn('sum',sequelize.col('stockQuantity')),'stockBalance']],group:['productId'],raw:true}).then(balance=>{cov_i28jkyac9.f[3]++;cov_i28jkyac9.s[8]++;return invRec.getProduct().then(product=>{cov_i28jkyac9.f[4]++;cov_i28jkyac9.s[9]++;if(product.reorderLevel<=balance[0].stockBalance){cov_i28jkyac9.b[0][0]++;cov_i28jkyac9.s[10]++;return product.createPurchaseOrder({orderQuantity:product.reorderQuantity,processed:'N',createdAt:sequelize.fn('NOW'),updatedAt:sequelize.fn('NOW'),productId:product.id}).then(order=>{cov_i28jkyac9.f[5]++;cov_i28jkyac9.s[11]++;return order;});}else{cov_i28jkyac9.b[0][1]++;}});});});cov_i28jkyac9.s[12]++;return inventory;};